<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Pointers Course | COMP1511</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
            background-color: #f8f7f2;
            color: #2c2c2c;
        }
        .concept-card {
            background-color: #ffffff;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .back-button {
            background-color: #f8f7f2;
            color: #2c2c2c;
            border: 2px solid #e07a5f;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }
        .back-button:hover {
            background-color: #e07a5f;
            color: #ffffff;
            transform: translateY(-2px);
        }
        .chapter-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            color: #2c2c2c;
            margin: 2rem 0;
        }
        .summary-card {
            background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%);
            color: #ffffff;
            border-radius: 0.5rem;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 16px -4px rgb(0 0 0 / 0.1);
        }
        .interactive-button {
            background-color: #e07a5f;
            color: #ffffff;
            border: none;
            border-radius: 0.375rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            margin: 0.5rem;
        }
        .interactive-button:hover {
            background-color: #d06850;
            transform: translateY(-2px);
        }
        .interactive-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        .interactive-button.secondary {
            background-color: #f4a261;
        }
        .interactive-button.secondary:hover {
            background-color: #e3941f;
        }
        .memory-visual {
            display: inline-flex;
            border: 2px solid #e07a5f;
            border-radius: 0.375rem;
            overflow: hidden;
            margin: 0.5rem;
            background-color: #ffffff;
            transition: all 0.3s ease;
        }
        .memory-visual.highlighted {
            border-color: #f4a261;
            box-shadow: 0 0 15px rgba(244, 162, 97, 0.5);
        }
        .memory-address {
            padding: 0.75rem 1rem;
            background-color: #8b8589;
            color: #ffffff;
            font-weight: 600;
            border-right: 2px solid #8b8589;
            font-family: 'Courier New', monospace;
            min-width: 5rem;
            text-align: center;
        }
        .memory-value {
            padding: 0.75rem;
            background-color: #f8f7f2;
            color: #2c2c2c;
            min-width: 4rem;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        .pointer-visual {
            display: inline-flex;
            border: 2px solid #f4a261;
            border-radius: 0.375rem;
            overflow: hidden;
            margin: 0.5rem;
            background-color: #ffffff;
            transition: all 0.3s ease;
        }
        .pointer-visual.highlighted {
            border-color: #e07a5f;
            box-shadow: 0 0 15px rgba(224, 122, 95, 0.5);
        }
        .pointer-name {
            padding: 0.75rem 1rem;
            background-color: #f4a261;
            color: #ffffff;
            font-weight: 600;
            border-right: 2px solid #f4a261;
            min-width: 4rem;
            text-align: center;
        }
        .pointer-value {
            padding: 0.75rem;
            background-color: #fff7ed;
            color: #2c2c2c;
            min-width: 6rem;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        .canvas-container {
            background-color: #f8f7f2;
            border-radius: 0.375rem;
            padding: 2rem;
            margin: 1rem 0;
            min-height: 300px;
            border: 2px dashed #e07a5f;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .input-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        .input-field {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.375rem;
            font-size: 1rem;
            font-family: 'Courier New', monospace;
        }
        .input-field:focus {
            outline: none;
            border-color: #e07a5f;
        }
        .array-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        .array-element {
            display: inline-flex;
            border: 2px solid #8b8589;
            border-radius: 0.375rem;
            overflow: hidden;
            background-color: #ffffff;
            transition: all 0.3s ease;
        }
        .array-element.pointer-target {
            border-color: #f4a261;
            box-shadow: 0 0 10px rgba(244, 162, 97, 0.5);
        }
        .array-index {
            padding: 0.5rem;
            background-color: #8b8589;
            color: #ffffff;
            font-weight: 600;
            border-right: 2px solid #8b8589;
            font-size: 0.8rem;
        }
        .array-value {
            padding: 0.5rem 1rem;
            background-color: #f8f7f2;
            color: #2c2c2c;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            min-width: 3rem;
            text-align: center;
        }
        .status-message {
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 0.375rem 0.375rem 0;
        }
        .error-message {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 0.375rem 0.375rem 0;
        }
        .step-indicator {
            background-color: #22c55e;
            color: #ffffff;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            margin-left: 1rem;
        }
        .pointer-arrow {
            font-size: 1.5rem;
            color: #f4a261;
            margin: 0 1rem;
            transition: all 0.3s ease;
        }
        .pointer-arrow.animated {
            transform: scale(1.2);
            color: #e07a5f;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 py-8 md:py-12 max-w-6xl">
        
        <!-- Back to COMP1511 Button -->
        <a href="../comp1511.html" class="back-button">
            <span>â†</span>
            <span>Back to COMP1511</span>
        </a>

        <!-- Chapter Header -->
        <header class="text-center mb-8">
            <h1 class="chapter-title">æŒ‡é’ˆäº’åŠ¨è¯¾ç¨‹</h1>
            <p class="text-xl text-gray-600">Interactive Pointers Course</p>
        </header>

        <!-- Course Introduction -->
        <div class="summary-card">
            <h2 class="text-2xl font-bold mb-4">è¯¾ç¨‹ç›®æ ‡</h2>
            <p class="text-lg mb-4">
                é€šè¿‡äº¤äº’å¼æ¼”ç¤ºå’Œå¯è§†åŒ–ï¼Œæ·±å…¥ç†è§£æŒ‡é’ˆçš„å·¥ä½œåŸç†ã€‚æœ¬è¯¾ç¨‹åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div class="bg-white bg-opacity-20 p-4 rounded-lg">
                    <h3 class="text-lg font-bold mb-2">ğŸ“ æ¨¡å—ä¸€ï¼šåœ°å€ä¸è§£å¼•ç”¨</h3>
                    <p>åŠ¨æ€åˆ›å»ºå˜é‡å’ŒæŒ‡é’ˆï¼Œå¯è§†åŒ–åœ°å€æŒ‡å‘å…³ç³»</p>
                </div>
                <div class="bg-white bg-opacity-20 p-4 rounded-lg">
                    <h3 class="text-lg font-bold mb-2">ğŸ”¢ æ¨¡å—äºŒï¼šæŒ‡é’ˆç®—æœ¯</h3>
                    <p>å±•ç¤ºæŒ‡é’ˆåœ¨æ•°ç»„ä¸­çš„ç§»åŠ¨å’Œè®¡ç®—è¿‡ç¨‹</p>
                </div>
            </div>
        </div>

        <!-- Module 1: Address and Dereference -->
        <div class="concept-card">
            <h3 class="text-2xl font-bold text-[#e07a5f] mb-4">æ¨¡å—ä¸€ï¼šåœ°å€ä¸è§£å¼•ç”¨å¯è§†åŒ–</h3>
            
            <p class="text-lg mb-4">
                åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œä½ å¯ä»¥åˆ›å»ºå˜é‡å’ŒæŒ‡é’ˆï¼Œç„¶åè§‚å¯Ÿå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚é€šè¿‡æŒ‡é’ˆä¿®æ”¹å˜é‡å€¼ï¼Œå®æ—¶çœ‹åˆ°å˜åŒ–ã€‚
            </p>

            <!-- Controls -->
            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                <h4 class="font-bold text-lg mb-3">æ§åˆ¶é¢æ¿</h4>
                
                <div class="input-group">
                    <label class="font-medium">å˜é‡åï¼š</label>
                    <input type="text" id="varName" class="input-field" placeholder="ä¾‹å¦‚: x" maxlength="10">
                    <label class="font-medium">åˆå§‹å€¼ï¼š</label>
                    <input type="number" id="varValue" class="input-field" placeholder="ä¾‹å¦‚: 42" style="width: 100px;">
                    <button onclick="createVariable()" class="interactive-button">åˆ›å»ºå˜é‡</button>
                </div>

                <div class="input-group">
                    <label class="font-medium">æŒ‡é’ˆåï¼š</label>
                    <input type="text" id="ptrName" class="input-field" placeholder="ä¾‹å¦‚: ptr" maxlength="10">
                    <label class="font-medium">æŒ‡å‘å˜é‡ï¼š</label>
                    <select id="ptrTarget" class="input-field" style="width: 120px;">
                        <option value="">é€‰æ‹©å˜é‡</option>
                    </select>
                    <button onclick="createPointer()" class="interactive-button">åˆ›å»ºæŒ‡é’ˆ</button>
                </div>

                <div class="input-group">
                    <label class="font-medium">é€šè¿‡æŒ‡é’ˆä¿®æ”¹å€¼ï¼š</label>
                    <select id="modifyPtr" class="input-field" style="width: 120px;">
                        <option value="">é€‰æ‹©æŒ‡é’ˆ</option>
                    </select>
                    <input type="number" id="newValue" class="input-field" placeholder="æ–°å€¼" style="width: 100px;">
                    <button onclick="modifyThroughPointer()" class="interactive-button secondary">ä¿®æ”¹å€¼</button>
                </div>

                <div class="input-group">
                    <button onclick="clearMemory()" class="interactive-button" style="background-color: #6b7280;">æ¸…ç©ºå†…å­˜</button>
                    <button onclick="showExample()" class="interactive-button secondary">æ˜¾ç¤ºç¤ºä¾‹</button>
                </div>
            </div>

            <!-- Memory Visualization -->
            <div class="canvas-container" id="memoryCanvas">
                <p class="text-gray-500">ç‚¹å‡»"åˆ›å»ºå˜é‡"å¼€å§‹å¯è§†åŒ–å†…å­˜å¸ƒå±€</p>
            </div>

            <!-- Status Messages -->
            <div id="statusMessage" class="hidden"></div>
        </div>

        <!-- Module 2: Pointer Arithmetic -->
        <div class="concept-card">
            <h3 class="text-2xl font-bold text-[#e07a5f] mb-4">æ¨¡å—äºŒï¼šæŒ‡é’ˆç®—æœ¯æ¼”ç¤º</h3>
            
            <p class="text-lg mb-4">
                åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œä½ å°†çœ‹åˆ°æŒ‡é’ˆå¦‚ä½•åœ¨æ•°ç»„ä¸­ç§»åŠ¨ï¼Œç†è§£æŒ‡é’ˆç®—æœ¯çš„å·¥ä½œåŸç†ã€‚
            </p>

            <!-- Array Setup -->
            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                <h4 class="font-bold text-lg mb-3">æ•°ç»„è®¾ç½®</h4>
                
                <div class="input-group">
                    <label class="font-medium">æ•°ç»„å…ƒç´ ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š</label>
                    <input type="text" id="arrayInput" class="input-field" placeholder="ä¾‹å¦‚: 10,20,30,40,50" style="width: 200px;">
                    <button onclick="createArray()" class="interactive-button">åˆ›å»ºæ•°ç»„</button>
                </div>

                <div class="input-group">
                    <button onclick="movePointerLeft()" class="interactive-button" id="ptrLeftBtn" disabled>ptr--</button>
                    <button onclick="movePointerRight()" class="interactive-button" id="ptrRightBtn" disabled>ptr++</button>
                    <button onclick="resetArrayPointer()" class="interactive-button secondary" id="resetPtrBtn" disabled>é‡ç½®æŒ‡é’ˆ</button>
                </div>

                <div class="input-group">
                    <label class="font-medium">æŒ‡é’ˆåç§»ï¼š</label>
                    <input type="number" id="offsetInput" class="input-field" placeholder="åç§»é‡" style="width: 100px;" min="0">
                    <button onclick="jumpToOffset()" class="interactive-button secondary" id="jumpBtn" disabled>è·³è½¬åˆ° ptr+n</button>
                </div>
            </div>

            <!-- Array Visualization -->
            <div class="canvas-container" id="arrayCanvas">
                <p class="text-gray-500">è¾“å…¥æ•°ç»„å…ƒç´ å¹¶ç‚¹å‡»"åˆ›å»ºæ•°ç»„"å¼€å§‹æ¼”ç¤º</p>
            </div>

            <!-- Pointer Info -->
            <div id="pointerInfo" class="hidden status-message">
                <h4 class="font-bold">å½“å‰æŒ‡é’ˆçŠ¶æ€ï¼š</h4>
                <p id="pointerStatus"></p>
            </div>
        </div>

        <!-- Code Examples -->
        <div class="concept-card">
            <h3 class="text-2xl font-bold text-[#e07a5f] mb-4">å¯¹åº”çš„Cä»£ç </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-bold text-lg mb-2">æ¨¡å—ä¸€ä»£ç ç¤ºä¾‹ï¼š</h4>
                    <div class="bg-gray-900 text-white p-4 rounded-lg font-mono text-sm">
<pre>int x = 42;           // åˆ›å»ºå˜é‡
int *ptr = &x;        // åˆ›å»ºæŒ‡é’ˆ

printf("x çš„å€¼: %d\n", x);
printf("x çš„åœ°å€: %p\n", &x);
printf("ptr çš„å€¼: %p\n", ptr);
printf("*ptr çš„å€¼: %d\n", *ptr);

*ptr = 100;           // é€šè¿‡æŒ‡é’ˆä¿®æ”¹
printf("ä¿®æ”¹å x: %d\n", x);</pre>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-bold text-lg mb-2">æ¨¡å—äºŒä»£ç ç¤ºä¾‹ï¼š</h4>
                    <div class="bg-gray-900 text-white p-4 rounded-lg font-mono text-sm">
<pre>int arr[] = {10,20,30,40,50};
int *ptr = arr;       // æŒ‡å‘æ•°ç»„é¦–å…ƒç´ 

printf("*ptr = %d\n", *ptr);     // 10
ptr++;                           // ç§»åŠ¨æŒ‡é’ˆ
printf("*ptr = %d\n", *ptr);     // 20

printf("*(ptr+2) = %d\n", *(ptr+2)); // 40
ptr = arr;                       // é‡ç½®æŒ‡é’ˆ</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="concept-card text-center">
            <h3 class="text-xl font-bold text-[#e07a5f] mb-4">ç»§ç»­å­¦ä¹ </h3>
            <div class="space-y-4">
                <a href="./1511_pointers_notes.html" class="back-button inline-flex">
                    <span>ğŸ“–</span>
                    <span>å›åˆ°æŒ‡é’ˆç¬”è®°</span>
                </a>
                <br>
                <a href="./1511_cmd_args_interactive.html" class="back-button inline-flex">
                    <span>ğŸš€</span>
                    <span>å‘½ä»¤è¡Œå‚æ•°äº’åŠ¨è¯¾ç¨‹</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        // Module 1: Memory Management
        let variables = {};
        let pointers = {};
        let nextAddress = 0x1000;

        function generateAddress() {
            const addr = nextAddress;
            nextAddress += 4; // Assume 4-byte integers
            return `0x${addr.toString(16).toUpperCase()}`;
        }

        function createVariable() {
            const name = document.getElementById('varName').value.trim();
            const value = parseInt(document.getElementById('varValue').value);
            
            if (!name) {
                showStatusMessage('è¯·è¾“å…¥å˜é‡å', 'error');
                return;
            }
            
            if (isNaN(value)) {
                showStatusMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼', 'error');
                return;
            }

            if (variables[name]) {
                showStatusMessage(`å˜é‡ ${name} å·²å­˜åœ¨`, 'error');
                return;
            }

            const address = generateAddress();
            variables[name] = { value: value, address: address };
            
            updateVariableSelects();
            renderMemory();
            showStatusMessage(`åˆ›å»ºå˜é‡ ${name} = ${value}ï¼Œåœ°å€: ${address}`, 'success');
            
            // Clear inputs
            document.getElementById('varName').value = '';
            document.getElementById('varValue').value = '';
        }

        function createPointer() {
            const name = document.getElementById('ptrName').value.trim();
            const target = document.getElementById('ptrTarget').value;
            
            if (!name) {
                showStatusMessage('è¯·è¾“å…¥æŒ‡é’ˆå', 'error');
                return;
            }
            
            if (!target) {
                showStatusMessage('è¯·é€‰æ‹©æŒ‡å‘çš„å˜é‡', 'error');
                return;
            }

            if (pointers[name]) {
                showStatusMessage(`æŒ‡é’ˆ ${name} å·²å­˜åœ¨`, 'error');
                return;
            }

            const address = generateAddress();
            pointers[name] = { 
                target: target, 
                address: address,
                value: variables[target].address 
            };
            
            updatePointerSelects();
            renderMemory();
            showStatusMessage(`åˆ›å»ºæŒ‡é’ˆ ${name}ï¼ŒæŒ‡å‘å˜é‡ ${target}`, 'success');
            
            // Clear inputs
            document.getElementById('ptrName').value = '';
            document.getElementById('ptrTarget').value = '';
        }

        function modifyThroughPointer() {
            const ptrName = document.getElementById('modifyPtr').value;
            const newValue = parseInt(document.getElementById('newValue').value);
            
            if (!ptrName) {
                showStatusMessage('è¯·é€‰æ‹©æŒ‡é’ˆ', 'error');
                return;
            }
            
            if (isNaN(newValue)) {
                showStatusMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼', 'error');
                return;
            }

            const pointer = pointers[ptrName];
            const targetVar = pointer.target;
            const oldValue = variables[targetVar].value;
            
            variables[targetVar].value = newValue;
            renderMemory();
            showStatusMessage(`é€šè¿‡æŒ‡é’ˆ ${ptrName} ä¿®æ”¹ ${targetVar}: ${oldValue} â†’ ${newValue}`, 'success');
            
            document.getElementById('newValue').value = '';
        }

        function updateVariableSelects() {
            const ptrTargetSelect = document.getElementById('ptrTarget');
            ptrTargetSelect.innerHTML = '<option value="">é€‰æ‹©å˜é‡</option>';
            
            for (const varName in variables) {
                const option = document.createElement('option');
                option.value = varName;
                option.textContent = varName;
                ptrTargetSelect.appendChild(option);
            }
        }

        function updatePointerSelects() {
            const modifySelect = document.getElementById('modifyPtr');
            modifySelect.innerHTML = '<option value="">é€‰æ‹©æŒ‡é’ˆ</option>';
            
            for (const ptrName in pointers) {
                const option = document.createElement('option');
                option.value = ptrName;
                option.textContent = ptrName;
                modifySelect.appendChild(option);
            }
        }

        function renderMemory() {
            const canvas = document.getElementById('memoryCanvas');
            canvas.innerHTML = '';

            if (Object.keys(variables).length === 0 && Object.keys(pointers).length === 0) {
                canvas.innerHTML = '<p class="text-gray-500">ç‚¹å‡»"åˆ›å»ºå˜é‡"å¼€å§‹å¯è§†åŒ–å†…å­˜å¸ƒå±€</p>';
                return;
            }

            const memoryDiv = document.createElement('div');
            memoryDiv.className = 'w-full';

            // Render variables
            if (Object.keys(variables).length > 0) {
                const varSection = document.createElement('div');
                varSection.innerHTML = '<h4 class="font-bold mb-4">å˜é‡å†…å­˜åŒºåŸŸ</h4>';
                const varContainer = document.createElement('div');
                varContainer.className = 'flex flex-wrap justify-center items-center gap-4 mb-6';

                for (const [varName, varData] of Object.entries(variables)) {
                    const varDiv = document.createElement('div');
                    varDiv.className = 'text-center';
                    
                    const varVisual = document.createElement('div');
                    varVisual.className = 'memory-visual';
                    
                    varVisual.innerHTML = `
                        <div class="memory-address">${varData.address}</div>
                        <div class="memory-value">${varData.value}</div>
                    `;
                    
                    const label = document.createElement('div');
                    label.className = 'mt-2 text-sm font-medium';
                    label.textContent = `å˜é‡ ${varName}`;
                    
                    varDiv.appendChild(varVisual);
                    varDiv.appendChild(label);
                    varContainer.appendChild(varDiv);
                }
                
                varSection.appendChild(varContainer);
                memoryDiv.appendChild(varSection);
            }

            // Render pointers
            if (Object.keys(pointers).length > 0) {
                const ptrSection = document.createElement('div');
                ptrSection.innerHTML = '<h4 class="font-bold mb-4">æŒ‡é’ˆå†…å­˜åŒºåŸŸ</h4>';
                const ptrContainer = document.createElement('div');
                ptrContainer.className = 'flex flex-wrap justify-center items-center gap-4';

                for (const [ptrName, ptrData] of Object.entries(pointers)) {
                    const ptrDiv = document.createElement('div');
                    ptrDiv.className = 'text-center';
                    
                    const ptrVisual = document.createElement('div');
                    ptrVisual.className = 'pointer-visual';
                    
                    ptrVisual.innerHTML = `
                        <div class="pointer-name">${ptrName}</div>
                        <div class="pointer-value">${ptrData.value}</div>
                    `;
                    
                    const arrow = document.createElement('span');
                    arrow.className = 'pointer-arrow mx-4';
                    arrow.innerHTML = 'â†’';
                    
                    const targetInfo = document.createElement('div');
                    targetInfo.className = 'text-sm';
                    targetInfo.innerHTML = `æŒ‡å‘å˜é‡ ${ptrData.target}<br>å€¼: ${variables[ptrData.target].value}`;
                    
                    const label = document.createElement('div');
                    label.className = 'mt-2 text-sm font-medium';
                    label.textContent = `æŒ‡é’ˆ ${ptrName}`;
                    
                    const fullDiv = document.createElement('div');
                    fullDiv.className = 'flex items-center';
                    fullDiv.appendChild(ptrVisual);
                    fullDiv.appendChild(arrow);
                    fullDiv.appendChild(targetInfo);
                    
                    ptrDiv.appendChild(fullDiv);
                    ptrDiv.appendChild(label);
                    ptrContainer.appendChild(ptrDiv);
                }
                
                ptrSection.appendChild(ptrContainer);
                memoryDiv.appendChild(ptrSection);
            }

            canvas.appendChild(memoryDiv);
        }

        function clearMemory() {
            variables = {};
            pointers = {};
            nextAddress = 0x1000;
            updateVariableSelects();
            updatePointerSelects();
            renderMemory();
            showStatusMessage('å†…å­˜å·²æ¸…ç©º', 'success');
        }

        function showExample() {
            clearMemory();
            
            // Create example variables and pointers
            variables['x'] = { value: 42, address: '0x1000' };
            variables['y'] = { value: 100, address: '0x1004' };
            pointers['ptr'] = { target: 'x', address: '0x2000', value: '0x1000' };
            
            nextAddress = 0x2004;
            updateVariableSelects();
            updatePointerSelects();
            renderMemory();
            showStatusMessage('ç¤ºä¾‹å·²åŠ è½½ï¼šå˜é‡ x=42, y=100ï¼ŒæŒ‡é’ˆ ptr æŒ‡å‘ x', 'success');
        }

        function showStatusMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = type === 'error' ? 'error-message' : 'status-message';
            statusDiv.innerHTML = `<p><strong>${type === 'error' ? 'é”™è¯¯' : 'æˆåŠŸ'}:</strong> ${message}</p>`;
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 3000);
        }

        // Module 2: Array and Pointer Arithmetic
        let array = [];
        let currentPointerIndex = 0;

        function createArray() {
            const input = document.getElementById('arrayInput').value.trim();
            
            if (!input) {
                showArrayMessage('è¯·è¾“å…¥æ•°ç»„å…ƒç´ ', 'error');
                return;
            }

            try {
                array = input.split(',').map(x => parseInt(x.trim()));
                if (array.some(isNaN)) {
                    throw new Error('æ— æ•ˆæ•°å­—');
                }
            } catch (e) {
                showArrayMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—ï¼Œç”¨é€—å·åˆ†éš”', 'error');
                return;
            }

            currentPointerIndex = 0;
            enableArrayButtons();
            renderArray();
            updatePointerInfo();
            showArrayMessage(`åˆ›å»ºäº†åŒ…å« ${array.length} ä¸ªå…ƒç´ çš„æ•°ç»„`, 'success');
        }

        function movePointerLeft() {
            if (currentPointerIndex > 0) {
                currentPointerIndex--;
                renderArray();
                updatePointerInfo();
                showArrayMessage(`æŒ‡é’ˆå‘å·¦ç§»åŠ¨åˆ°ç´¢å¼• ${currentPointerIndex}`, 'success');
            }
        }

        function movePointerRight() {
            if (currentPointerIndex < array.length - 1) {
                currentPointerIndex++;
                renderArray();
                updatePointerInfo();
                showArrayMessage(`æŒ‡é’ˆå‘å³ç§»åŠ¨åˆ°ç´¢å¼• ${currentPointerIndex}`, 'success');
            }
        }

        function resetArrayPointer() {
            currentPointerIndex = 0;
            renderArray();
            updatePointerInfo();
            showArrayMessage('æŒ‡é’ˆé‡ç½®åˆ°æ•°ç»„å¼€å¤´', 'success');
        }

        function jumpToOffset() {
            const offset = parseInt(document.getElementById('offsetInput').value);
            
            if (isNaN(offset) || offset < 0 || offset >= array.length) {
                showArrayMessage(`åç§»é‡å¿…é¡»åœ¨ 0 åˆ° ${array.length - 1} ä¹‹é—´`, 'error');
                return;
            }

            currentPointerIndex = offset;
            renderArray();
            updatePointerInfo();
            showArrayMessage(`æŒ‡é’ˆè·³è½¬åˆ°ç´¢å¼• ${offset}`, 'success');
            document.getElementById('offsetInput').value = '';
        }

        function enableArrayButtons() {
            document.getElementById('ptrLeftBtn').disabled = false;
            document.getElementById('ptrRightBtn').disabled = false;
            document.getElementById('resetPtrBtn').disabled = false;
            document.getElementById('jumpBtn').disabled = false;
        }

        function renderArray() {
            const canvas = document.getElementById('arrayCanvas');
            canvas.innerHTML = '';

            if (array.length === 0) {
                canvas.innerHTML = '<p class="text-gray-500">è¾“å…¥æ•°ç»„å…ƒç´ å¹¶ç‚¹å‡»"åˆ›å»ºæ•°ç»„"å¼€å§‹æ¼”ç¤º</p>';
                return;
            }

            const arrayContainer = document.createElement('div');
            arrayContainer.className = 'array-container';

            // Render array elements
            for (let i = 0; i < array.length; i++) {
                const elementDiv = document.createElement('div');
                elementDiv.className = `array-element ${i === currentPointerIndex ? 'pointer-target' : ''}`;
                
                elementDiv.innerHTML = `
                    <div class="array-index">[${i}]</div>
                    <div class="array-value">${array[i]}</div>
                `;
                
                arrayContainer.appendChild(elementDiv);
            }

            // Add pointer indicator
            const pointerIndicator = document.createElement('div');
            pointerIndicator.className = 'w-full text-center mt-4';
            pointerIndicator.innerHTML = `
                <div class="flex justify-center items-center gap-2">
                    <span class="text-lg font-bold text-[#f4a261]">ptr</span>
                    <span class="pointer-arrow animated">â†‘</span>
                    <span class="text-sm text-gray-600">æŒ‡å‘ç´¢å¼• ${currentPointerIndex}</span>
                </div>
            `;

            canvas.appendChild(arrayContainer);
            canvas.appendChild(pointerIndicator);

            // Update button states
            document.getElementById('ptrLeftBtn').disabled = currentPointerIndex === 0;
            document.getElementById('ptrRightBtn').disabled = currentPointerIndex === array.length - 1;
        }

        function updatePointerInfo() {
            const infoDiv = document.getElementById('pointerInfo');
            const statusP = document.getElementById('pointerStatus');
            
            if (array.length > 0) {
                const baseAddress = 0x1000;
                const currentAddress = baseAddress + (currentPointerIndex * 4); // Assume 4-byte integers
                
                statusP.innerHTML = `
                    <strong>ptr</strong> æŒ‡å‘æ•°ç»„ç´¢å¼• <strong>${currentPointerIndex}</strong><br>
                    <strong>*ptr</strong> = ${array[currentPointerIndex]}<br>
                    <strong>ptr</strong> çš„åœ°å€å€¼: 0x${currentAddress.toString(16).toUpperCase()}<br>
                    æ•°ç»„åŸºåœ°å€: 0x${baseAddress.toString(16).toUpperCase()}ï¼Œåç§»: ${currentPointerIndex * 4} å­—èŠ‚
                `;
                infoDiv.classList.remove('hidden');
            } else {
                infoDiv.classList.add('hidden');
            }
        }

        function showArrayMessage(message, type) {
            // Create a temporary message element
            const canvas = document.getElementById('arrayCanvas');
            const existingMsg = canvas.querySelector('.temp-message');
            if (existingMsg) existingMsg.remove();

            const msgDiv = document.createElement('div');
            msgDiv.className = `temp-message mt-4 p-3 rounded-lg ${type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
            msgDiv.innerHTML = `<strong>${type === 'error' ? 'é”™è¯¯' : 'æ“ä½œ'}:</strong> ${message}`;
            
            canvas.appendChild(msgDiv);
            
            setTimeout(() => {
                msgDiv.remove();
            }, 2000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateVariableSelects();
            updatePointerSelects();
        });
    </script>
</body>
</html> 